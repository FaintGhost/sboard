# Lessons

- 当用户明确要求“迁移到 RPC”时，交付过程中必须避免任何会被理解为“回退到 OpenAPI client”的动作，即便是过渡状态也要在同一轮内说明范围与剩余项。
- 执行多阶段迁移时，`tasks/todo.md` 和会话内 todo 需要同步更新，防止用户看到进度与实际实现不一致。
- 涉及“协议/路由架构切换”的改动，必须先区分运行模式与测试模式：可在生产路径收敛（仅 RPC+特例 REST），但要给现有单测保留兼容分支，避免一次改动导致海量无关测试 404。
- 文档收口必须以“当前可运行架构”为准：当实现已切 RPC 后，README/AGENTS/DESIGN 里的 OpenAPI/REST 管理面描述要同步更新，并明确仅保留订阅 REST 兼容入口，避免文档和代码分叉。
